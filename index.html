<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TOP SECRET INVITATION</title>
    <style>
        /* --- 1. BAKGRUND & RUMMET (The Desk) --- */
        body, html {
            margin: 0;
            padding: 0;
            height: 100dvh; /* Mobile viewport fix för adressfältet */
            width: 100vw;
            overflow: hidden; /* Förhindra scroll under animationen */
            font-family: 'Courier New', Courier, monospace;
            background-color: #1a1a1a; /* Mörkare grundfärg för nattläge */
            overscroll-behavior: none; /* Förhindra "bounce" scroll på mobil */
            position: fixed; /* Lås position för att förhindra scroll */
        }

        .desk-surface {
            width: 100%;
            height: 100%;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            perspective: 1000px;
            overflow: hidden;
        }

        #background-layer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            /* Portrait-First: Center Bottom focus */
            background: url('Bakgrund.png') no-repeat center bottom;
            background-size: cover; 
            transition: background 1.5s ease;
            z-index: 0;
            filter: brightness(0.15) grayscale(1) blur(2px); /* Neutral nattläge */
            transform: scale(1.1);
        }

        @media (min-width: 1024px) {
            #background-layer {
                background-size: cover;
                background-position: center center;
            }
        }

        :root {
            --dossier-scale: 1;
        }

        /* --- 2. MAPPEN (The Asset) --- */
        .dossier-container {
            position: absolute;
            /* Mobile First: Maximera bredd */
            width: 61vw; 
            /* Beräkna höjd för att fylla skärmen men behålla formen */
            aspect-ratio: 3/4; 
            height: auto;
            max-height: 45dvh;
            
            /* Centrera mappen */
            top: 50%;
            left: 50%;
            cursor: pointer;
            opacity: 1; /* Mappen är redan där */
            transform: translate(-50%, -50%) scale(var(--dossier-scale)) rotate(2deg);
            transform-style: preserve-3d; /* För 3D-öppning */
            z-index: 15; /* Säkerställ att den är klickbar */
            will-change: transform;
            -webkit-tap-highlight-color: transparent;
        }

        @media (min-width: 1024px) {
            .dossier-container {
                max-width: 800px;
                height: 85vh;
                max-height: none;
                width: auto;
            }
        }

        .manila-folder {
            width: 100%;
            height: 100%;
            background-color: #dcbfa3;
            background-image: linear-gradient(to bottom, rgba(255,255,255,0.1), rgba(0,0,0,0.1));
            border-radius: 1vw;
            border-bottom: 0.5vw solid #bba388;
            border-right: 0.25vw solid #c5ad90;
            position: relative;
            box-shadow: 
                0 1px 2px rgba(0,0,0,0.9), /* Skarp Kontakt */
                0 10px 20px rgba(0,0,0,0.3), /* Mellan */
                0 30px 60px rgba(0,0,0,0.2), /* Ambient */
                inset 0 0 60px rgba(139, 69, 19, 0.15); /* Smuts/slitage inuti */
            transform-origin: center;
            transition: transform 0.2s ease, transform 1.5s cubic-bezier(0.4, 0, 0.2, 1); /* Längre tid för öppning */
            transform-origin: left center; /* Öppnas som en bok */
            z-index: 10;
            transform-style: preserve-3d;
            filter: brightness(0.2); /* Starta mörkt */
        }

        /* Mappens "Tab" (Fliken där uppe) */
        .manila-folder::before {
            content: '';
            position: absolute;
            top: -5%;
            right: 0;
            width: 35%;
            height: 6%;
            background-color: #dcbfa3;
            border-radius: 1vw 1vw 0 0;
            box-shadow: inset 0 0 10px rgba(139, 69, 19, 0.1);
            backface-visibility: hidden; /* Dölj baksidan av fliken vid rotation */
        }

        /* Insidan av pärmen (Baksidan av framsidan) */
        .manila-folder::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #dcbfa3;
            transform: rotateY(180deg);
            backface-visibility: hidden; /* Syns bara när den är vänd mot kameran */
            border-radius: 1vw;
            box-shadow: inset 0 0 60px rgba(139, 69, 19, 0.15);
        }

        /* Hover effekt på mappen */
        @media (hover: hover) {
            .dossier-container:hover .manila-folder {
                transform: scale(1.01);
            }
        }

        /* Öppna mappen */
        .dossier-container.open .manila-folder {
            transform: rotateY(-175deg); /* Slå upp pärmen */
        }

        /* --- 3. STÄMPLAR --- */
        .stamp {
            position: absolute;
            font-weight: bold;
            text-transform: uppercase;
            border: 4px solid;
            padding: 1vh 2vw;
            opacity: 0.7;
            mix-blend-mode: multiply; /* Får det att se ut som bläck på papper */
            pointer-events: none; /* Klick går igenom stämpeln */
            border-radius: 255px 15px 225px 15px / 15px 225px 15px 255px; /* Ojämn form */
            -webkit-mask-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="300" height="150"><filter id="noise"><feTurbulence type="fractalNoise" baseFrequency="0.6" numOctaves="5" stitchTiles="stitch"/></filter><rect width="100%" height="100%" filter="url(%23noise)" opacity="0.6"/></svg>');
            mask-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="300" height="150"><filter id="noise"><feTurbulence type="fractalNoise" baseFrequency="0.6" numOctaves="5" stitchTiles="stitch"/></filter><rect width="100%" height="100%" filter="url(%23noise)" opacity="0.6"/></svg>');
        }

        .top-secret {
            color: #b30000;
            border-color: #b30000;
            font-size: clamp(1.5rem, 8vw, 3rem);
            top: 20%;
            left: 10%;
            transform: rotate(-15deg);
            border-radius: 8px;
        }

        .eyes-only {
            color: #8b0000;
            border-color: #8b0000;
            font-size: clamp(1rem, 4vw, 1.5rem);
            bottom: 25%;
            right: 10%;
            transform: rotate(10deg);
            border-style: double;
            border-width: 6px;
        }

        /* --- 5. ANIMATION --- */
        @keyframes breathing {
            0% { transform: translate(-50%, -50%) scale(var(--dossier-scale)) rotate(2deg); }
            100% { transform: translate(-50%, -50%) scale(calc(var(--dossier-scale) * 1.01)) rotate(2deg); }
        }

        @keyframes switchOn {
            0% { filter: brightness(0.15) grayscale(1) blur(2px); }
            /* Mjukare uppvärmning av glödtråden */
            5% { filter: brightness(0.6) sepia(0.4) hue-rotate(-10deg) blur(0.5px); } 
            10% { filter: brightness(1.0) sepia(0) hue-rotate(0deg) blur(0px); } 
            /* Efter-flimmer (instabil lampa) */
            12% { filter: brightness(0.8) sepia(0.1) hue-rotate(0deg) blur(0px); }
            14% { filter: brightness(1.0) sepia(0) hue-rotate(0deg) blur(0px); }
            15% { filter: brightness(0.9) sepia(0.05) hue-rotate(0deg) blur(0px); }
            16% { filter: brightness(1.0) sepia(0) hue-rotate(0deg) blur(0px); }
            25% { filter: brightness(0.95) sepia(0) hue-rotate(0deg) blur(0px); }
            26% { filter: brightness(1.0) sepia(0) hue-rotate(0deg) blur(0px); }
            100% { filter: brightness(1.0) sepia(0) hue-rotate(0deg) blur(0px); }
        }

        @keyframes folderSwitchOn {
            0% { filter: brightness(0.2); }
            5% { filter: brightness(0.8); } /* Matchar uppvärmning */
            10% { filter: brightness(1.0); } /* Normal */
            /* Efter-flimmer */
            12% { filter: brightness(0.8); }
            14% { filter: brightness(1.0); }
            15% { filter: brightness(0.9); }
            16% { filter: brightness(1.0); }
            25% { filter: brightness(0.95); }
            26% { filter: brightness(1.0); }
            100% { filter: brightness(1.0); }
        }

        @keyframes switchOnVignette {
            0% { opacity: 0.8; } /* Mörka hörn i natten */
            1% { opacity: 0; } /* Ljuset blåser bort skuggorna */
            5% { opacity: 0.2; } /* Normal vinjett */
            /* Efter-flimmer */
            12% { opacity: 0.3; }
            14% { opacity: 0.2; }
            15% { opacity: 0.25; }
            16% { opacity: 0.2; }
            25% { opacity: 0.22; }
            26% { opacity: 0.2; }
            100% { opacity: 0.2; }
        }

        /* --- 6. INNEHÅLL (Papper & Video) --- */
        .folder-back {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #cbb685; /* Mörkare insida av mappen */
            border-radius: 1vw;
            z-index: 1;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.3);
            mix-blend-mode: multiply; /* Låt bordet lysa igenom mappen */
        }

        .paper-sheet {
            position: absolute;
            top: 2%;
            left: 2%;
            right: 2%;
            bottom: 2%;
            z-index: 2;
            padding: 10px; /* Reduced padding for mobile */
            display: block;
            overflow-y: auto; /* Enable vertical scrolling */
            overflow-x: hidden; /* Prevent horizontal scroll */
            perspective: 1500px; /* Djup för 3D-effekten */
            transform-style: preserve-3d;
            opacity: 0;
            transition: opacity 1s ease 0.5s; /* Tona in efter att mappen börjat öppnas */
            
            /* Textur & Form */
            transform: rotate(-2deg);
            
            /* Integration i rummet */
            filter: sepia(0.4) contrast(1.2) brightness(0.9);
        }
        
        .dossier-container.open .paper-sheet {
            opacity: 1;
        }

        /* --- SID-STRUKTUR --- */
        .page-section {
            width: 100%;
            display: flex;
            flex-direction: column;
            box-sizing: border-box;
            padding: 25px;
            background-color: #f4f1ea; /* Gammalt papper */
            backface-visibility: hidden; /* Dölj baksidan vid vändning */
            
            border-radius: 2px;
            filter: drop-shadow(0 1px 3px rgba(0,0,0,0.5));
        }

        #page-1 {
            position: absolute; /* Overlay on top */
            top: 0;
            left: 0;
            height: 100%;
            justify-content: space-between; /* Text i toppen, pil i botten */
            cursor: pointer; /* Indikera att man kan klicka för att gå vidare */
            z-index: 5;
            transform-origin: left center; /* Rotera runt "ryggen" */
            transition: transform 1.2s cubic-bezier(0.645, 0.045, 0.355, 1); /* Snygg ease-in-out */
        }

        #page-1.turned {
            transform: rotateY(-180deg); /* Vänd bladet helt */
        }

        #page-2 {
            position: relative; /* Flow content to allow scrolling */
            height: 100%;
            justify-content: flex-start;
            z-index: 1;
            overflow-x: hidden;
            width: 100%;
            display: none;
            flex-direction: column;
        }
        
        .typewriter-text {
            font-family: 'Courier New', Courier, monospace;
            color: #333;
            opacity: 0.85;
            font-size: 0.55rem; /* Extremt kompakt för mobil */
            line-height: 1.05; 
            margin-bottom: 2px;
            white-space: pre-wrap; /* Bevara radbrytningar */
            text-shadow: 0 0 1px rgba(0, 0, 0, 0.4);
            mix-blend-mode: multiply;
        }

        .scroll-hint {
            text-align: left;
            font-size: 0.55rem;
            line-height: 1.05;
            color: #b30000;
            cursor: pointer;
            opacity: 0; /* Syns först när texten är klar */
            transition: opacity 1s;
            padding: 10px 0 0 0;
        }

        @keyframes bounce { 0%, 20%, 50%, 80%, 100% {transform: translateY(0);} 40% {transform: translateY(-5px);} 60% {transform: translateY(-3px);} }

        .cursor {
            display: inline-block;
            width: 8px;
            height: 15px;
            background-color: #222;
            animation: blink 1s infinite;
        }

        @keyframes blink { 50% { opacity: 0; } }

        /* Visa innehåll när texten är klar */
        .paper-sheet.content-loaded .scroll-hint {
            opacity: 1 !important;
        }

        @media (min-width: 1024px) {
            .typewriter-text, .scroll-hint {
                font-size: 1.0rem;
                line-height: 1.4;
                margin-bottom: 15px;
            }
            .page-section {
                padding: 50px;
            }
        }

        /* --- 7. FORMULÄR (RSVP Protocol) --- */
        .mission-form {
            width: 90%;
            height: 100%;
            flex: 1;
            display: flex;
            flex-direction: column;
            max-width: 100%;
            margin: 0 auto;
        }

        .mission-form iframe {
            height: auto !important;
            flex: 1;
            min-height: 0;
            width: 100%;
            max-width: 100%;
            box-sizing: border-box;
            pointer-events: auto;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-weight: bold;
            font-size: 0.8rem;
            margin-bottom: 5px;
            color: #333;
            opacity: 0.85;
            text-shadow: 0 0 1px rgba(0, 0, 0, 0.4);
            mix-blend-mode: multiply;
        }

        .form-input, .form-select {
            width: 100%;
            border: none;
            border-bottom: 2px solid #222;
            background: transparent;
            font-family: 'Courier New', Courier, monospace;
            font-size: 1rem;
            color: #111;
            outline: none;
            padding: 5px 0;
            border-radius: 0;
        }

        .submit-stamp {
            margin-top: 10px;
            flex-shrink: 0;
            width: 100%;
            padding: 5px 10px;
            border: 2px solid #b30000;
            color: #b30000;
            background: transparent;
            font-family: 'Courier New', Courier, monospace;
            font-weight: bold;
            font-size: 0.6rem;
            text-transform: uppercase;
            cursor: pointer;
            transform: rotate(-1deg);
            transition: transform 0.2s, background 0.2s;
            mask-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="100"><filter id="noise"><feTurbulence type="fractalNoise" baseFrequency="0.8" numOctaves="3" stitchTiles="stitch"/></filter><rect width="100%" height="100%" filter="url(%23noise)" opacity="0.8"/></svg>');
            -webkit-mask-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="100"><filter id="noise"><feTurbulence type="fractalNoise" baseFrequency="0.8" numOctaves="3" stitchTiles="stitch"/></filter><rect width="100%" height="100%" filter="url(%23noise)" opacity="0.8"/></svg>');
        }

        .submit-stamp:hover {
            transform: rotate(0deg) scale(1.02);
            background: rgba(179, 0, 0, 0.05);
        }

        /* Success Stamp Animation */
        .confidential-stamp-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(3);
            opacity: 0;
            border: 6px solid #b30000;
            color: #b30000;
            padding: 20px;
            font-size: 2.5rem;
            font-weight: bold;
            text-transform: uppercase;
            pointer-events: none;
            z-index: 100;
            mix-blend-mode: multiply;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            text-align: center;
            white-space: nowrap;
            background: rgba(255, 255, 255, 0.4);
        }

        .stamp-visible {
            opacity: 0.9;
            transform: translate(-50%, -50%) scale(1) rotate(-15deg);
        }

        /* --- 8. RÖK-EFFEKT (Cigarette Smoke) --- */
        #smoke-container {
            position: absolute;
            /* Flyttad till övre högra hörnet för mobil */
            top: 5%; 
            right: 5%;
            width: 40px;
            height: 40px;
            z-index: 50;
            pointer-events: none;
        }

        .smoke-puff {
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 25px;
            height: 25px;
            background: radial-gradient(circle, rgba(220, 220, 240, 0.8) 0%, transparent 70%);
            border-radius: 50%;
            filter: blur(3px);
            opacity: 0;
            mix-blend-mode: screen;
            animation: smokeRise 5s ease-out forwards;
        }

        @keyframes smokeRise {
            0% { opacity: 0; transform: translate(-50%, 0) scale(0.5) rotate(var(--rot)); }
            20% { opacity: 0.8; }
            100% { opacity: 0; transform: translate(var(--tx), -250px) scale(8) rotate(var(--rot-end)); }
        }

        /* --- 9. AMBIENT FLICKER & COLD DEATH (Trasig lampa) --- */
        #vignette {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            background: radial-gradient(circle, transparent 40%, #000 140%);
            z-index: 200; /* Ligger över allt */
            opacity: 0.8; /* Mörkt rum initialt */
        }

        #cold-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            background-color: rgba(10, 20, 30, 0.6); /* Mörkblå/grå */
            mix-blend-mode: hard-light; /* Kall, död ton */
            z-index: 190; /* Ligger under vinjetten men över rummet */
            opacity: 0;
        }

        @keyframes flicker {
            0%, 28% { opacity: 0.2; }
            /* Kluster 1: Snabbt dubbel-blink */
            28.1% { opacity: 0.95; }
            28.2% { opacity: 0.1; }
            28.3% { opacity: 0.95; }
            28.4%, 58% { opacity: 0.2; }
            
            /* Kluster 2: Aggressivt anfall (Strobe) */
            58.1% { opacity: 0.95; }
            58.2% { opacity: 0.0; }
            58.3% { opacity: 0.95; }
            58.4% { opacity: 0.0; }
            58.5% { opacity: 0.95; }
            58.6%, 90% { opacity: 0.2; }
            
            /* Kluster 3: Dödsryckning */
            90.1% { opacity: 0.95; }
            90.2% { opacity: 0.1; }
            90.3% { opacity: 0.95; }
            94% { opacity: 0.95; } /* Håll mörkt en stund */
            94.1%, 100% { opacity: 0.2; }
        }

        @keyframes cold-flicker {
            0%, 28% { opacity: 0; }
            28.1% { opacity: 1; }
            28.2% { opacity: 0; }
            28.3% { opacity: 1; }
            28.4%, 58% { opacity: 0; }
            58.1% { opacity: 1; }
            58.2% { opacity: 0; }
            58.3% { opacity: 1; }
            58.4% { opacity: 0; }
            58.5% { opacity: 1; }
            58.6%, 90% { opacity: 0; }
            90.1% { opacity: 1; }
            90.2% { opacity: 0; }
            90.3% { opacity: 1; }
            94% { opacity: 1; }
            94.1%, 100% { opacity: 0; }
        }

        /* --- 10. DISTANT LIGHT (Candle Reflection) --- */
        .distant-light {
            position: absolute;
            top: -35vh;
            right: -35vw;
            width: 1000px;
            height: 1000px;
            /* Mjukare orange */
            background: radial-gradient(circle, rgba(255, 150, 50, 0.3) 0%, transparent 70%);
            filter: blur(80px);
            mix-blend-mode: color-dodge; /* Lyser upp fibrerna */
            opacity: 0.4; /* Mer subtil intensitet */
            pointer-events: none;
            z-index: 20; /* Ligger över mappen (z-index 15) */
        }

        @keyframes candle-flicker {
            0% { opacity: 0.4; transform: translate(0, 0) scale(1); }
            10% { opacity: 0.5; transform: translate(-5px, 3px) scale(1.2); }
            20% { opacity: 0.35; transform: translate(3px, -5px) scale(0.85); }
            30% { opacity: 0.45; transform: translate(-8px, 2px) scale(1.3); }
            40% { opacity: 0.4; transform: translate(5px, 5px) scale(0.95); }
            50% { opacity: 0.5; transform: translate(-3px, -3px) scale(1.4); }
            60% { opacity: 0.3; transform: translate(6px, 0) scale(0.8); }
            70% { opacity: 0.45; transform: translate(-5px, 5px) scale(1.25); }
            80% { opacity: 0.4; transform: translate(2px, -4px) scale(1.1); }
            90% { opacity: 0.35; transform: translate(-2px, 2px) scale(0.9); }
            100% { opacity: 0.4; transform: translate(0, 0) scale(1); }
        }

        /* --- FISH ANIMATION (Easter Egg) --- */
        .fish-container {
            position: absolute;
            pointer-events: none;
            z-index: 10010;
        }

        /* --- GOLDFISH (Prey) --- */
        .goldfish {
            width: 60px; height: 35px;
            top: 50%; left: -100px;
            animation: swimPrey 6s cubic-bezier(0.45, 0.05, 0.55, 0.95) forwards;
        }

        .goldfish .fish-body {
            width: 100%; height: 100%;
            background: radial-gradient(circle at 30% 30%, #ffcc00, #ff8c00);
            border-radius: 50% 50% 40% 40%;
            position: relative;
            z-index: 2;
        }

        .goldfish .fish-eye {
            position: absolute;
            top: 8px; right: 10px;
            width: 8px; height: 8px;
            background: white;
            border-radius: 50%;
            border: 1px solid #cc7000;
        }
        .goldfish .fish-eye::after {
            content: ''; position: absolute;
            top: 2px; right: 1px;
            width: 3px; height: 3px;
            background: black; border-radius: 50%;
        }

        .goldfish .fish-tail {
            position: absolute;
            right: 85%; top: 15%;
            width: 20px; height: 25px;
            background: rgba(255, 140, 0, 0.9);
            clip-path: polygon(100% 50%, 0 0, 0 100%);
            transform-origin: 100% 50%;
            animation: tailWag 0.15s infinite alternate;
        }

        .goldfish .fish-fin-side {
            position: absolute;
            top: 55%; left: 40%;
            width: 15px; height: 10px;
            background: rgba(255, 200, 0, 0.8);
            border-radius: 50%;
            transform: rotate(20deg);
            animation: finFlutter 0.3s infinite alternate;
        }

        /* --- SHARK (Predator) --- */
        .shark {
            width: 220px; height: 90px;
            top: 55%; left: -300px;
            animation: swimPredator 5s cubic-bezier(0.45, 0.05, 0.55, 0.95) 1s forwards; /* Startar 1s senare */
        }

        .shark .fish-body {
            width: 100%; height: 100%;
            background: #2f4f4f;
            border-radius: 40% 60% 30% 40%; /* Strömlinjeformad */
            position: relative;
            z-index: 2;
        }

        .shark .shark-fin-dorsal {
            position: absolute;
            bottom: 80%; left: 45%;
            width: 50px; height: 50px;
            background: #2f4f4f;
            clip-path: polygon(0 100%, 40% 0, 100% 100%);
            transform: skewX(-20deg);
        }

        .shark .shark-jaw {
            position: absolute;
            bottom: 5px; right: 15px;
            width: 50px; height: 25px;
            background: #1a2f2f;
            border-radius: 0 0 10px 30px;
            transform-origin: 0% 0%;
            animation: jawChomp 0.8s infinite;
        }

        .shark .fish-tail {
            position: absolute;
            right: 92%; top: 5%;
            width: 50px; height: 80px;
            background: #2f4f4f;
            clip-path: polygon(100% 50%, 0 0, 25% 50%, 0 100%);
            transform-origin: 100% 50%;
            animation: tailWag 0.4s infinite alternate;
        }

        /* --- ANIMATIONS --- */
        @keyframes tailWag { from { transform: rotate(15deg); } to { transform: rotate(-15deg); } }
        @keyframes finFlutter { from { transform: rotate(20deg) scaleY(1); } to { transform: rotate(10deg) scaleY(0.8); } }
        @keyframes jawChomp { 0%, 100% { transform: rotate(0deg); } 50% { transform: rotate(15deg); } }

        @keyframes swimPrey {
            0% { transform: translate(0, 0) rotate(0deg); left: -100px; }
            20% { transform: translate(20vw, -10vh) rotate(-15deg); }
            40% { transform: translate(40vw, 10vh) rotate(10deg); }
            50% { transform: translate(50vw, 0) rotate(0deg); } /* Kollisionspunkt (ca 3s) */
            100% { transform: translate(120vw, -20vh) rotate(-10deg); }
        }

        @keyframes swimPredator {
            0% { transform: translate(0, 0) rotate(0deg); left: -300px; }
            20% { transform: translate(25vw, -8vh) rotate(-10deg); }
            40% { transform: translate(45vw, 8vh) rotate(5deg); } /* Hinner ikapp (2s in i anim = 3s totalt) */
            100% { transform: translate(120vw, -15vh) rotate(-5deg); }
        }

        /* --- PARTICLES & BUBBLES --- */
        .blood-particle {
            position: absolute;
            background: #8a0303;
            border-radius: 50%;
            pointer-events: none;
            animation: disperse 1s forwards;
        }
        @keyframes disperse {
            to { transform: translate(var(--tx), var(--ty)); opacity: 0; }
        }

        .bg-bubble {
            position: absolute;
            bottom: -50px;
            background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2), rgba(255,255,255,0.05));
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 50%;
            pointer-events: none;
            animation: bubbleRise linear forwards;
        }
        @keyframes bubbleRise {
            0% { transform: translateX(0); }
            25% { transform: translateX(20px); }
            50% { transform: translateX(-20px); }
            75% { transform: translateX(10px); }
            100% { bottom: 110vh; transform: translateX(0); }
        }

        /* --- INTRO SEQUENCE --- */
        #intro-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #000;
            z-index: 10000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: #fff;
            padding: 40px;
            box-sizing: border-box;
        }

        .intro-text {
            font-size: clamp(1rem, 3vw, 1.5rem);
            margin-bottom: 30px;
            opacity: 0;
            transition: opacity 2s ease;
            max-width: 800px;
            text-align: center;
        }

        .intro-buttons {
            display: flex;
            gap: 40px;
            opacity: 0;
            transition: opacity 1s ease;
        }

        .intro-btn {
            background: transparent;
            border: 2px solid #fff;
            color: #fff;
            padding: 15px 40px;
            font-family: 'Courier New', Courier, monospace;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .intro-btn:hover {
            background: #fff;
            color: #000;
            transform: scale(1.1);
        }

        /* --- ANIMATION TRIGGERS --- */
        body.sequence-started #background-layer { animation: switchOn 3s 1.5s forwards; }
        body.sequence-started .manila-folder { animation: folderSwitchOn 3s 1.5s forwards; }
        body.sequence-started #vignette { animation: switchOnVignette 3s 1.5s forwards, flicker 4s 1.8s infinite; }
        body.sequence-started #cold-overlay { animation: cold-flicker 4s 1.8s infinite; }
        body.sequence-started .distant-light { animation: candle-flicker 2s infinite; }

    </style>
</head>
<body>
    <!-- Intro Overlay -->
    <div id="intro-overlay">
        <div id="intro-content" style="display: flex; flex-direction: column; align-items: center;"></div>
    </div>

    <!-- Bakgrundsbild -->
    <div id="background-layer"></div>

    <!-- Vinjett / Lampa -->
    <div id="vignette"></div>
    <div id="cold-overlay"></div>

    <!-- Skrivbordet -->
    <div class="desk-surface" id="desk">
        
        <!-- Sekundär ljuskälla -->
        <div class="distant-light"></div>
        
        <!-- Mappen -->
        <div class="dossier-container" id="dossier">
            
            <!-- Baksidan av mappen (ligger underst) -->
            <div class="folder-back"></div>

            <!-- Pappret inuti -->
            <div class="paper-sheet">
                <!-- SIDA 1: Briefing -->
                <div id="page-1" class="page-section" onclick="scrollToForm()">
                    <div id="typewriter-container" class="typewriter-text"></div>
                </div>

                <!-- SIDA 2: Formulär -->
                <div id="page-2" class="page-section">
                    <div class="mission-form">
                        <iframe src="https://docs.google.com/forms/d/e/1FAIpQLSeCUxG5geXDdrCG9URQht-5y2zaBVieY36ua8_QPqOwG3puNQ/viewform?embedded=true" width="64" height="908" frameborder="0" marginheight="0" marginwidth="0">Läser in …</iframe>
                        <button onclick="triggerDestructionSequence()" class="submit-stamp">BEKRÄFTA INSKICKAT & FÖRSTÖR</button>
                    </div>
                </div>
                
                <!-- Success Stamp -->
                <div id="confidential-stamp" class="confidential-stamp-overlay">CONFIDENTIAL</div>
            </div>

            <!-- Framsidan (Locket) -->
            <div class="manila-folder">
                <!-- Stämplar -->
                <div class="stamp top-secret">TOP SECRET</div>
                <div class="stamp eyes-only">EYES ONLY</div>
            </div>

        </div>

    </div>

    <!-- Rök-effekt -->
    <div id="smoke-container"></div>

    <script>
        // Texten som ska skrivas ut
        const missionSegments = [
            { text: "OPERATION: Historiens första Brädspels-Meisterschaft.", style: "font-size: clamp(0.7rem, 4vw, 1.4rem); font-weight: 800; display: block; margin: 2px 0; line-height: 1.0;" },
            { text: "\nUPPDRAG: Dominans via brädspel.\n\nDATUM: 2026-01-03.\nTID: 1600 timmar (ZULU tid).\nPLATS: Sektor Enskede Gård.\nADRESS: Lindevägen 16.\n\nPROTOKOLL: Total diskretion krävs. Fienden lyssnar, kanske.\nREKOMMENDERAD TÄCKMANTEL: Hatt, uppslagen dagstidning eller mörka solglasögon.\n\nVinnaren av årets Brädspels-Meisterschaft kommer få ett pris bortom ära och rikedom.\n\nInstruktioner: Granska underrättelserna.\n\n>> KLICKA HÄR FÖR ATT GÅ VIDARE <<" }
        ];
        
        let currentSegment = 0;
        let currentChar = 0;
        let currentSpan = null;
        let isTyping = false;
        let autoOpenTimeout;

        // Starta rök-generatorn
        // Anpassa frekvens baserat på skärmstorlek för prestanda
        const smokeInterval = window.innerWidth < 768 ? 90 : 20; // Justerad intensitet (-20%)
        setInterval(createSmoke, smokeInterval);

        function createSmoke() {
            const container = document.getElementById('smoke-container');
            const puff = document.createElement('span');
            puff.classList.add('smoke-puff');
            
            // Slumpmässig drift i sidled (--tx)
            const tx = (Math.random() - 0.5) * 200; // Ökad spridning
            puff.style.setProperty('--tx', `${tx}px`);
            
            // Slumpmässig rotation
            const rot = Math.random() * 360;
            const rotEnd = rot + (Math.random() * 180 - 90);
            puff.style.setProperty('--rot', `${rot}deg`);
            puff.style.setProperty('--rot-end', `${rotEnd}deg`);
            
            container.appendChild(puff);

            // Ta bort elementet när animationen är klar
            setTimeout(() => { puff.remove(); }, 5000);
        }

        // Koppla händelselyssnare för både klick och touch
        const dossier = document.getElementById('dossier');
        dossier.addEventListener('click', openDossier);
        // Lägg till en passiv touchstart för att förbättra responsen på iOS
        document.addEventListener('touchstart', function() {}, {passive: true});
        

        // Funktion för att öppna mappen
        function openDossier() {
            clearTimeout(autoOpenTimeout); // Avbryt automatisk öppning om man klickar
            
            // Förhindra dubbelklick
            if (dossier.classList.contains('open')) return;

            console.log('Access Granted');
            
            // 1. Öppna mappen (animation)
            // Instant response for mobile
            dossier.classList.add('open');

            // 2. Starta skrivmaskin
            setTimeout(() => {
                if (!isTyping) {
                    isTyping = true;
                    typeWriter();
                }
            }, 500); // Snabbare start av texten
        }

        function typeWriter() {
            if (currentSegment < missionSegments.length) {
                const segment = missionSegments[currentSegment];
                const container = document.getElementById("typewriter-container");
                
                // Skapa element för stylad text om vi är i början av segmentet
                if (segment.style && currentChar === 0) {
                    currentSpan = document.createElement('span');
                    currentSpan.style.cssText = segment.style;
                    container.appendChild(currentSpan);
                }

                const char = segment.text.charAt(currentChar);
                
                if (segment.style) {
                    currentSpan.textContent += char;
                } else {
                    // För vanlig text, lägg till i containern (effektivt sätt att hantera textnoder)
                    if (container.lastChild && container.lastChild.nodeType === 3) {
                        container.lastChild.nodeValue += char;
                    } else {
                        container.appendChild(document.createTextNode(char));
                    }
                }
                
                // Snabbare skrivmaskin (oregelbunden rytm)
                let delay = Math.random() * 30 + 20; 
                
                // Gör "OPERATION"-delen långsammare och mer spänningsfull
                if (currentSegment === 0) {
                    delay = Math.random() * 120 + 80;
                }
                
                // Pausa vid punkter och kommatecken
                if (char === '.' || char === '!' || char === '?') delay += 200;
                if (char === ',') delay += 100;
                if (char === '\n') delay += 150;

                // Slumpmässig "tankepaus"
                if (Math.random() > 0.98) delay += 300;

                currentChar++;
                if (currentChar >= segment.text.length) {
                    currentSegment++;
                    currentChar = 0;
                    currentSpan = null;
                }

                setTimeout(typeWriter, delay);
            } else {
                // Visa videon och formuläret när texten är klar
                document.querySelector('.paper-sheet').classList.add('content-loaded');
            }
        }

        function scrollToForm() {
            document.getElementById('page-2').style.display = 'flex';
            document.getElementById('page-1').classList.add('turned');
        }

        function triggerDestructionSequence() {
            // 1. Stämpla dokumentet
            const stamp = document.getElementById('confidential-stamp');
            stamp.classList.add('stamp-visible');

            // 2. Ändra texten efter en kort stund
            setTimeout(() => {
                const container = document.querySelector('.paper-sheet');
                
                // Layout-justeringar: Centrera vertikalt/horisontellt, dölj scroll
                container.style.overflow = 'hidden';
                container.style.display = 'flex';
                container.style.flexDirection = 'column';
                container.style.justifyContent = 'center';
                container.style.alignItems = 'center';

                // Rensa innehållet och visa meddelande
                container.innerHTML = `
                    <h2 style="color:#b30000; border: 4px solid #b30000; padding: 20px; transform: rotate(-5deg); text-align: center; margin: 0 0 30px 0; font-size: clamp(1.5rem, 6vw, 2.5rem);">IDENTITET BEKRÄFTAD</h2>
                    <p style="font-weight:bold; text-align: center; margin: 0; font-size: clamp(0.9rem, 4vw, 1.2rem);">DITT DELTAGANDE HAR REGISTRERATS.<br><br>ÄT UPP DETTA DOKUMENT OM <span id="countdown" style="font-size: 1.4em; color: #b30000;">5</span> SEKUNDER.</p>
                `;

                let timeLeft = 5;
                const countdownEl = document.getElementById('countdown');
                const timer = setInterval(() => {
                    timeLeft--;
                    if (countdownEl) countdownEl.innerText = timeLeft;
                    if (timeLeft <= 0) {
                        clearInterval(timer);
                        
                        // Skapa blackout-gardin för filmisk övergång
                        const curtain = document.createElement('div');
                        curtain.id = 'blackout-curtain';
                        curtain.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: black; z-index: 99999; opacity: 0; transition: opacity 1s ease; pointer-events: none;';
                        document.body.appendChild(curtain);
                        
                        // Trigga animation
                        setTimeout(() => curtain.style.opacity = '1', 10);

                        // Vänta på att skärmen är svart (1s) innan vi rensar
                        setTimeout(() => {
                            document.body.innerHTML = '';
                            document.body.style.backgroundColor = 'black';

                            // Visa hemligt meddelande
                            setTimeout(() => {
                                const msg = document.createElement('div');
                                msg.innerHTML = "Plats: Lindevägen 16, Enskede gård.<br>Tid: Från kl 17, 3 januari.<br>Kom totalt diskret.";
                                msg.style.cssText = "position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #ddd; font-family: 'Courier New', Courier, monospace; text-align: center; opacity: 0; transition: opacity 3s ease; width: 90%; font-size: 1.2rem; line-height: 1.6;";
                                document.body.appendChild(msg);
                                setTimeout(() => msg.style.opacity = '1', 50);
                            }, 1000);
                        }, 1000);
                    }
                }, 1000);
            }, 1500);
        }

        // --- INTRO SEQUENCE LOGIC ---
        window.addEventListener('load', runIntroSequence);

        async function runIntroSequence() {
            const container = document.getElementById('intro-content');
            const texts = [
                "Du har blivit utvald.",
                "Utvald till ett uppdrag av väsentlig nationell, samt internationell, vikt.",
                "Observera att obehörigt röjande av informationen hanteras som landsförräderi.",
                "Är du helt säker att du vill ta del av föreliggande material?"
            ];

            // Skapa text-elementet
            const p = document.createElement('div');
            p.className = 'intro-text';
            container.appendChild(p);

            for (let i = 0; i < texts.length; i++) {
                p.innerHTML = texts[i];
                
                // Tona in
                p.style.opacity = 1;

                // Standard väntetid: 2s (fade in) + 3s (lästid) = 5s
                let waitTime = 5000;
                // Korta ned första meningen och sista frågan (innan knappar) med 0.5s
                if (i === 0 || i === texts.length - 1) {
                    waitTime = 4500;
                }
                await new Promise(r => setTimeout(r, waitTime));

                if (i < texts.length - 1) {
                    // Tona ut
                    p.style.opacity = 0;
                    // Vänta: 2s (fade out)
                    await new Promise(r => setTimeout(r, 2000));
                }
            }

            // Visa knappar
            const btnContainer = document.createElement('div');
            btnContainer.className = 'intro-buttons';
            btnContainer.innerHTML = `
                <button class="intro-btn" onclick="handleIntroChoice('yes')">JA</button>
                <button class="intro-btn" onclick="handleIntroChoice('no')">NEJ</button>
            `;
            container.appendChild(btnContainer);
            void btnContainer.offsetWidth;
            btnContainer.style.opacity = 1;
        }

        function startMainSequence() {
            const overlay = document.getElementById('intro-overlay');
            const content = document.getElementById('intro-content');
            
            // Fade out content
            content.style.transition = 'opacity 1s';
            content.style.opacity = 0;

            setTimeout(() => {
                content.innerHTML = `<div class='intro-text' style='opacity:1; display:flex; flex-direction:column; align-items:center;'>
                    <span style='font-size: 2rem; margin-bottom: 10px;'>Tärningen är kastad</span>
                    <span style='font-size: 1rem; opacity: 0.8;'>Och snart i dubbel bemärkelse</span>
                </div>`;
                content.style.opacity = 1;

                setTimeout(() => {
                    overlay.style.transition = 'opacity 2s';
                    overlay.style.opacity = 0;
                    
                    // Start room animations
                    document.body.classList.add('sequence-started');

                    setTimeout(() => {
                        overlay.remove();
                        // Start auto-open timer
                        autoOpenTimeout = setTimeout(openDossier, 10000);
                    }, 2000);
                }, 2000);
            }, 1000);
        }

        let rejectionStep = 0;

        function handleIntroChoice(choice) {
            const container = document.getElementById('intro-content');
            const textEl = container.querySelector('.intro-text');
            
            if (rejectionStep === 0) {
                // Startläge: JA = Starta, NEJ = Gå till avböj-flöde
                if (choice === 'yes') {
                    startMainSequence();
                } else {
                    rejectionStep = 1;
                    if (textEl) textEl.innerText = "Säker?";
                }
            } else if (rejectionStep === 1) {
                // Steg 2: Säker? JA = Bekräfta avböj (vidare), NEJ = Ångra (starta)
                if (choice === 'yes') {
                    rejectionStep = 2;
                    if (textEl) textEl.innerText = "Helt säker?";
                } else {
                    startMainSequence();
                }
            } else if (rejectionStep === 2) {
                // Steg 3: Helt säker? JA = Bekräfta (Fisk), NEJ = Ångra (starta)
                if (choice === 'yes') {
                    const btnContainer = container.querySelector('.intro-buttons');
                    if (btnContainer) btnContainer.style.display = 'none';
                    if (textEl) textEl.innerText = "okej";
                    setTimeout(() => {
                        document.getElementById('intro-overlay').innerHTML = '';
                        startFishChase();
                    }, 2000);
                } else {
                    startMainSequence();
                }
            }
        }

        function startFishChase() {
            const overlay = document.getElementById('intro-overlay');
            
            // 1. Skapa atmosfär (Bubblor)
            for (let i = 0; i < 10; i++) {
                const bubble = document.createElement('div');
                bubble.className = 'bg-bubble';
                const size = Math.random() * 30 + 10;
                bubble.style.width = `${size}px`;
                bubble.style.height = `${size}px`;
                bubble.style.left = `${Math.random() * 100}vw`;
                bubble.style.animationDuration = `${Math.random() * 5 + 5}s`;
                bubble.style.animationDelay = `${Math.random() * 5}s`;
                overlay.appendChild(bubble);
            }

            // 2. Skapa Guldfisken (Bytet)
            const prey = document.createElement('div');
            prey.className = 'fish-container goldfish';
            prey.innerHTML = `
                <div class="fish-body">
                    <div class="fish-eye"></div>
                    <div class="fish-fin-side"></div>
                </div>
                <div class="fish-tail"></div>
            `;
            overlay.appendChild(prey);
            
            // 3. Skapa Hajen (Rovdjuret)
            const predator = document.createElement('div');
            predator.className = 'fish-container shark';
            predator.innerHTML = `
                <div class="fish-body">
                    <div class="shark-jaw"></div>
                    <div class="shark-fin-dorsal"></div>
                </div>
                <div class="fish-tail"></div>
            `;
            overlay.appendChild(predator);

            // 4. Hantera kollisionen (ca 3 sekunder in)
            setTimeout(() => {
                // Ta bort guldfisken
                prey.style.display = 'none';

                // Skapa blod/partikel-effekt
                for (let i = 0; i < 15; i++) {
                    const p = document.createElement('div');
                    p.className = 'blood-particle';
                    p.style.width = `${Math.random() * 8 + 2}px`;
                    p.style.height = p.style.width;
                    p.style.left = '50vw'; // Ungefärlig kollisionspunkt
                    p.style.top = '50vh';
                    
                    // Slumpmässig spridning
                    const angle = Math.random() * Math.PI * 2;
                    const velocity = Math.random() * 100 + 50;
                    p.style.setProperty('--tx', `${Math.cos(angle) * velocity}px`);
                    p.style.setProperty('--ty', `${Math.sin(angle) * velocity}px`);
                    
                    overlay.appendChild(p);
                }
            }, 3000);
        }
    </script>
</body>
</html>